<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Redes - Subnetting, DHCP, DNS</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts - Fuentes futuristas -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="assets/css/site.css">
</head>
<body>
    <!-- Navbar Neón -->
    <nav class="navbar-neon navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="neon-text" href="index.html"><i class="bi bi-house-door"></i> SOURCE-IT</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" style="border-color: #00ff88;">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link-neon" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="guia_redes.html">Redes</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="linux_cheatsheet.html">Linux</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="virtualbox.html">VirtualBox</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="conversor_binario_hexadecimal.html">Conversor</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="MySQL.html">MySQL</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="dhcp_dns.html">DHCP/DNS</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="lenguajes_de_marcas.html">Lenguajes</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="Css_basico.html">CSS Básico</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="Js_basico.html">JavaScript</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="freeplane.html">Freeplane</a></li>
                    <li class="nav-item ms-3"><button id="themeToggle" class="theme-btn btn" title="Cambiar tema"><i class="bi bi-palette-fill"></i></button></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <div class="hero text-center">
        <h1 class="display-4 fw-bold"><i class="bi bi-diagram-3"></i> Guía Completa de Redes</h1>
        <p class="lead">Subnetting, Planificación, DHCP, DNS y Calculadora IP</p>
    </div>

    <div class="container py-4">
        <!-- Aviso de VirtualBox -->
        <div class="alert alert-info d-flex align-items-center" role="alert">
            <i class="bi bi-info-circle-fill me-2 fs-4"></i>
            <div>¿Quieres practicar en máquinas virtuales? Visita nuestra sección de <a href="virtualbox.html" class="alert-link">VirtualBox con Debian 13</a>.</div>
        </div>

        <!-- PARTE I: SUBNETTING -->
        <h2 class="section-title" id="subnetting"><i class="bi bi-hdd-network"></i> Parte I: Subnetting y Planificación</h2>

        <!-- 1. ¿Qué es una red? -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-question-circle"></i> 1. ¿Qué es una red?
            </div>
            <div class="card-body p-4">
                <p>Una red es un conjunto de dispositivos interconectados que se comunican utilizando direcciones IP. Estos dispositivos pueden ser ordenadores, servidores, routers, switches, etc.</p>
                <div class="d-flex justify-content-around align-items-center flex-wrap">
                    <span class="badge bg-primary p-3">PC / Host</span>
                    <i class="bi bi-arrow-right fs-3 text-secondary"></i>
                    <span class="badge bg-primary p-3">Switch</span>
                    <i class="bi bi-arrow-right fs-3 text-secondary"></i>
                    <span class="badge bg-primary p-3">Router</span>
                    <i class="bi bi-arrow-right fs-3 text-secondary"></i>
                    <span class="badge bg-primary p-3">Internet</span>
                </div>
            </div>
        </div>

        <!-- 2. Direcciones IP y máscara -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-pin-map"></i> 2. Direcciones IP y Máscara de Subred
            </div>
            <div class="card-body p-4">
                <p>Una dirección IPv4 está compuesta por 4 octetos (32 bits). La máscara de subred determina qué parte identifica la red y qué parte el host.</p>
                <div class="alert alert-info-custom alert-custom">
                    <strong>Ejemplo:</strong> <code>192.168.1.10 /24</code> → primeros 24 bits (3 octetos) red, últimos 8 bits host.
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="command-list">
                            <li><span class="badge-cmd">IP</span> Identificador único de 32 bits</li>
                            <li><span class="badge-cmd">Máscara</span> Define red y host</li>
                            <li><span class="badge-cmd">CIDR</span> Notación /n (ej. /24)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <div class="code-block">
# Ejemplo en binario
IP:       192.168.1.10 = 11000000.10101000.00000001.00001010
Máscara:  255.255.255.0 = 11111111.11111111.11111111.00000000
Red:      192.168.1.0   = 11000000.10101000.00000001.00000000
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Concepto de Subnetting -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-scissors"></i> 3. Concepto de Subnetting
            </div>
            <div class="card-body p-4">
                <p>División de una red grande en subredes más pequeñas para optimizar direcciones y mejorar gestión.</p>
                <div class="alert alert-success-custom alert-custom">
                    <strong>Ventajas:</strong> optimización, organización, aislamiento de tráfico, reducción de broadcast.
                </div>
                <div class="d-flex justify-content-around align-items-center flex-wrap">
                    <span class="badge bg-warning p-3">Red original /24</span>
                    <i class="bi bi-arrow-right fs-3 text-secondary"></i>
                    <span class="badge bg-success p-3">Subred 1 /26</span>
                    <span class="badge bg-success p-3">Subred 2 /26</span>
                    <span class="badge bg-success p-3">Subred 3 /26</span>
                    <span class="badge bg-success p-3">Subred 4 /26</span>
                </div>
            </div>
        </div>

        <!-- 4. Ejemplo práctico de Subnetting -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-table"></i> 4. Ejemplo: Dividir 192.168.1.0/24 en 4 subredes /26
            </div>
            <div class="card-body p-4">
                <table class="table table-bordered">
                    <thead>
                        <tr><th>Subred</th><th>Red</th><th>Rango hosts</th><th>Broadcast</th><th>Hosts</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>192.168.1.0/26</td><td>192.168.1.1 - 192.168.1.62</td><td>192.168.1.63</td><td>62</td></tr>
                        <tr><td>2</td><td>192.168.1.64/26</td><td>192.168.1.65 - 192.168.1.126</td><td>192.168.1.127</td><td>62</td></tr>
                        <tr><td>3</td><td>192.168.1.128/26</td><td>192.168.1.129 - 192.168.1.190</td><td>192.168.1.191</td><td>62</td></tr>
                        <tr><td>4</td><td>192.168.1.192/26</td><td>192.168.1.193 - 192.168.1.254</td><td>192.168.1.255</td><td>62</td></tr>
                    </tbody>
                </table>
                <div class="alert alert-warning-custom alert-custom mt-3">
                    <i class="bi bi-exclamation-triangle"></i> La primera IP de cada subred es la dirección de red (no asignable) y la última es broadcast (no asignable).
                </div>
            </div>
        </div>

        <!-- 5. VLSM -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-rulers"></i> 5. VLSM (Variable Length Subnet Mask)
            </div>
            <div class="card-body p-4">
                <p>Permite crear subredes de diferentes tamaños según necesidades, maximizando eficiencia.</p>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card bg-light p-3">
                            <h5>Administración</h5>
                            <p>50 hosts → /26 (62 hosts)</p>
                            <code>192.168.1.0/26</code>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light p-3">
                            <h5>Ventas</h5>
                            <p>20 hosts → /27 (30 hosts)</p>
                            <code>192.168.1.64/27</code>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light p-3">
                            <h5>IT</h5>
                            <p>10 hosts → /28 (14 hosts)</p>
                            <code>192.168.1.96/28</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. VLANs -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-diagram-2"></i> 6. Planificación con VLANs
            </div>
            <div class="card-body p-4">
                <p>Las VLANs segmentan lógicamente la red, cada una con su propia subred IP.</p>
                <table class="table table-bordered">
                    <thead><tr><th>VLAN</th><th>Propósito</th><th>Red</th></tr></thead>
                    <tbody>
                        <tr><td>10</td><td>Usuarios</td><td>192.168.10.0/24</td></tr>
                        <tr><td>20</td><td>Servidores</td><td>192.168.20.0/24</td></tr>
                        <tr><td>30</td><td>Invitados</td><td>192.168.30.0/24</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- PARTE II: DHCP -->
        <h2 class="section-title" id="dhcp"><i class="bi bi-broadcast"></i> Parte II: Protocolo DHCP</h2>

        <!-- 7. Configuración de parámetros de red -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-gear"></i> 7. Parámetros de red
            </div>
            <div class="card-body p-4">
                <p>Un equipo necesita: IP, máscara, gateway, DNS. Configuración puede ser estática o dinámica (DHCP).</p>
                <div class="row">
                    <div class="col-md-6">
                        <h5>Estática</h5>
                        <ul>
                            <li>Control total</li>
                            <li>IP fija para servidores</li>
                            <li>Riesgo de conflictos</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>Dinámica (DHCP)</h5>
                        <ul>
                            <li>Configuración automática</li>
                            <li>Sin conflictos</li>
                            <li>Gestión centralizada</li>
                        </ul>
                    </div>
                </div>
                <div class="code-block">
# Ejemplo /etc/network/interfaces (Debian)
auto enp0s3
iface enp0s3 inet static
  address 192.168.1.100
  netmask 255.255.255.0
  gateway 192.168.1.1

# DHCP
iface enp0s3 inet dhcp
                </div>
            </div>
        </div>

        <!-- 8. Qué es DHCP -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-question-lg"></i> 8. ¿Qué es DHCP?
            </div>
            <div class="card-body p-4">
                <p><strong>DHCP</strong> (Dynamic Host Configuration Protocol) permite a dispositivos obtener configuración de red automáticamente.</p>
                <ul>
                    <li>Modelo cliente-servidor</li>
                    <li>Puertos UDP: 67 (servidor), 68 (cliente)</li>
                    <li>Basado en BOOTP (RFC 1541, 2131)</li>
                </ul>
            </div>
        </div>

        <!-- 9. Tipos de asignación -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-tags"></i> 9. Tipos de asignación
            </div>
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card bg-light p-3">
                            <h5>Manual/Estática</h5>
                            <p>Reserva IP por MAC. Ideal para servidores.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light p-3">
                            <h5>Automática</h5>
                            <p>Asigna IP permanente del pool.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light p-3">
                            <h5>Dinámica</h5>
                            <p>IP temporal (lease time). La más común.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 10. Proceso DORA -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-arrow-repeat"></i> 10. Proceso DORA
            </div>
            <div class="card-body p-4">
                <div class="row text-center">
                    <div class="col-md-3">
                        <span class="badge bg-info p-3">1. DISCOVER</span>
                        <p>Cliente broadcast</p>
                    </div>
                    <div class="col-md-3">
                        <span class="badge bg-success p-3">2. OFFER</span>
                        <p>Servidor ofrece IP</p>
                    </div>
                    <div class="col-md-3">
                        <span class="badge bg-warning p-3">3. REQUEST</span>
                        <p>Cliente acepta</p>
                    </div>
                    <div class="col-md-3">
                        <span class="badge bg-primary p-3">4. ACK</span>
                        <p>Servidor confirma</p>
                    </div>
                </div>
                <div class="alert alert-info-custom alert-custom mt-3">
                    <strong>Tiempos de concesión:</strong> T1 (50%) renovación con mismo servidor; T2 (87.5%) con cualquier servidor; expiración → nuevo DISCOVER.
                </div>
            </div>
        </div>

        <!-- 11. Mensajes DHCP -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-envelope"></i> 11. Mensajes DHCP
            </div>
            <div class="card-body p-4">
                <table class="table table-bordered">
                    <thead><tr><th>Mensaje</th><th>Dirección</th><th>Función</th></tr></thead>
                    <tbody>
                        <tr><td>DISCOVER</td><td>Cliente → Broadcast</td><td>Buscar servidores</td></tr>
                        <tr><td>OFFER</td><td>Servidor → Cliente</td><td>Ofrecer configuración</td></tr>
                        <tr><td>REQUEST</td><td>Cliente → Broadcast</td><td>Aceptar oferta</td></tr>
                        <tr><td>ACK</td><td>Servidor → Cliente</td><td>Confirmar</td></tr>
                        <tr><td>NAK</td><td>Servidor → Cliente</td><td>Rechazar</td></tr>
                        <tr><td>DECLINE</td><td>Cliente → Servidor</td><td>IP en uso</td></tr>
                        <tr><td>RELEASE</td><td>Cliente → Servidor</td><td>Liberar IP</td></tr>
                        <tr><td>INFORM</td><td>Cliente → Servidor</td><td>Parámetros adicionales</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 12. Parámetros asignados por DHCP -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-list-check"></i> 12. Parámetros asignados
            </div>
            <div class="card-body p-4">
                <ul>
                    <li>IP, máscara, gateway, DNS, nombre de dominio, broadcast, lease time, etc.</li>
                </ul>
            </div>
        </div>

        <!-- 13. Agente Relay -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-arrow-left-right"></i> 13. DHCP Relay Agent
            </div>
            <div class="card-body p-4">
                <p>Permite que un servidor DHCP atienda múltiples subredes. El router convierte broadcast en unicast hacia el servidor.</p>
                <div class="code-block">
# Instalación en Debian
sudo apt install isc-dhcp-relay
# Configurar /etc/default/isc-dhcp-relay
SERVERS="192.168.1.100"
INTERFACES="enp0s3 enp0s8"
                </div>
            </div>
        </div>

        <!-- 14. Configuración del servidor DHCP -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-server"></i> 14. Configuración del servidor DHCP (isc-dhcp-server)
            </div>
            <div class="card-body p-4">
                <div class="code-block">
# Instalación
sudo apt install isc-dhcp-server

# Archivo /etc/dhcp/dhcpd.conf
authoritative;
default-lease-time 600;
max-lease-time 7200;
option domain-name "miempresa.local";
option domain-name-servers 8.8.8.8, 8.8.4.4;

subnet 192.168.10.0 netmask 255.255.255.0 {
  range 192.168.10.50 192.168.10.100;
  option routers 192.168.10.1;
}

host servidor-web {
  hardware ethernet 00:1A:2B:3C:4D:5E;
  fixed-address 192.168.10.10;
}
                </div>
                <p>Gestión del servicio:</p>
                <div class="code-block">
sudo systemctl start isc-dhcp-server
sudo systemctl enable isc-dhcp-server
sudo tail -f /var/log/syslog
                </div>
            </div>
        </div>

        <!-- PARTE III: DNS -->
        <h2 class="section-title" id="dns"><i class="bi bi-globe"></i> Parte III: DNS</h2>

        <!-- 15. Conceptos DNS -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-book"></i> 15. Conceptos DNS
            </div>
            <div class="card-body p-4">
                <p>Traduce nombres de dominio a IPs.</p>
                <ul>
                    <li>Jerarquía: Root (.), TLD (.com), dominio, subdominio</li>
                    <li>Tipos de servidores: recursivo, autoritativo, root, TLD</li>
                </ul>
            </div>
        </div>

        <!-- 16. Tipos de registros DNS -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-file-text"></i> 16. Tipos de registros DNS
            </div>
            <div class="card-body p-4">
                <table class="table table-bordered">
                    <thead><tr><th>Tipo</th><th>Descripción</th><th>Ejemplo</th></tr></thead>
                    <tbody>
                        <tr><td>A</td><td>IPv4</td><td>ejemplo.com → 93.184.216.34</td></tr>
                        <tr><td>AAAA</td><td>IPv6</td><td>ejemplo.com → 2001:db8::1</td></tr>
                        <tr><td>CNAME</td><td>Alias</td><td>www → ejemplo.com</td></tr>
                        <tr><td>MX</td><td>Correo</td><td>@ → mail.ejemplo.com (10)</td></tr>
                        <tr><td>NS</td><td>Name Server</td><td>@ → ns1.ejemplo.com</td></tr>
                        <tr><td>PTR</td><td>Inversa</td><td>IP → nombre</td></tr>
                        <tr><td>TXT</td><td>Texto</td><td>SPF, DKIM</td></tr>
                        <tr><td>SOA</td><td>Start of Authority</td><td>Información de zona</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 17. Comandos de diagnóstico DNS -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-terminal"></i> 17. Comandos DNS
            </div>
            <div class="card-body p-4">
                <div class="code-block">
# nslookup
nslookup google.com
nslookup -type=MX google.com

# dig
dig google.com
dig +short google.com
dig -x 8.8.8.8

# host
host google.com
host -a google.com
                </div>
            </div>
        </div>

        <!-- 18. Configuración de BIND9 -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-gear-fill"></i> 18. Servidor DNS con BIND9
            </div>
            <div class="card-body p-4">
                <div class="code-block">
# Instalación
sudo apt install bind9 bind9utils

# Archivos: /etc/bind/named.conf, /etc/bind/named.conf.local, /etc/bind/zones/

# Ejemplo zona directa /etc/bind/zones/db.ejemplo.com
$TTL 604800
@ IN SOA ns1.ejemplo.com. admin.ejemplo.com. (2024020101 604800 86400 2419200 604800)
@ IN NS ns1.ejemplo.com.
@ IN A 192.168.1.10
www IN A 192.168.1.20

# Verificar
sudo named-checkconf
sudo named-checkzone ejemplo.com /etc/bind/zones/db.ejemplo.com
sudo systemctl restart bind9
                </div>
            </div>
        </div>

        <!-- CALCULADORA DE SUBNETTING -->
        <h2 class="section-title" id="calculadora"><i class="bi bi-calculator"></i> Calculadora de Subnetting</h2>
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-calculator"></i> Calculadora IP interactiva
            </div>
            <div class="card-body p-4">
                <!-- Aquí se incluye el código de la calculadora original (SubnetCalculator) -->
                <div class="calculator-container">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="ipAddress" class="form-label">Dirección IP:</label>
                                <input type="text" class="form-control" id="ipAddress" value="192.168.1.100">
                            </div>
                            <div class="mb-3">
                                <label for="netmaskDecimal" class="form-label">Máscara decimal:</label>
                                <input type="text" class="form-control" id="netmaskDecimal" value="255.255.255.0">
                            </div>
                            <div class="mb-3">
                                <label for="netmaskCIDR" class="form-label">CIDR (/):</label>
                                <input type="number" class="form-control" id="netmaskCIDR" min="0" max="32" value="24">
                            </div>
                            <div class="mb-3">
                                <label for="subnetMethod" class="form-label">División en subredes:</label>
                                <select class="form-select" id="subnetMethod">
                                    <option value="none">No dividir</option>
                                    <option value="cidr">Por nueva máscara CIDR</option>
                                    <option value="count">Por número de subredes</option>
                                    <option value="hosts">Por hosts necesarios</option>
                                </select>
                            </div>
                            <div class="mb-3" id="subnetValueContainer" style="display: none;">
                                <label for="subnetValue" class="form-label">Valor:</label>
                                <input type="number" class="form-control" id="subnetValue">
                            </div>
                            <button id="calculateBtn" class="btn btn-primary me-2">Calcular</button>
                            <button id="clearBtn" class="btn btn-secondary">Limpiar</button>
                        </div>
                        <div class="col-md-6" id="resultsSection" style="display: none;">
                            <h5>Resultados</h5>
                            <div id="networkInfo"></div>
                        </div>
                    </div>
                    <div id="subnetsCard" class="mt-4" style="display: none;">
                        <h5>Subredes calculadas</h5>
                        <div id="subnetsInfo"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fórmulas rápidas (tabla resumen) -->
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-lightbulb"></i> Tabla de referencia rápida
            </div>
            <div class="card-body p-4">
                <table class="table table-bordered">
                    <thead><tr><th>CIDR</th><th>Máscara</th><th>Hosts</th></tr></thead>
                    <tbody>
                        <tr><td>/24</td><td>255.255.255.0</td><td>254</td></tr>
                        <tr><td>/25</td><td>255.255.255.128</td><td>126</td></tr>
                        <tr><td>/26</td><td>255.255.255.192</td><td>62</td></tr>
                        <tr><td>/27</td><td>255.255.255.224</td><td>30</td></tr>
                        <tr><td>/28</td><td>255.255.255.240</td><td>14</td></tr>
                        <tr><td>/29</td><td>255.255.255.248</td><td>6</td></tr>
                        <tr><td>/30</td><td>255.255.255.252</td><td>2</td></tr>
                    </tbody>
                </table>
                <div class="code-block">
# Fórmulas
Número de subredes = 2^(bits prestados)
Hosts por subred = 2^(32 - CIDR) - 2
Salto = 256 - último octeto de máscara
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Created by Jemarin Birt LH ASIR 2025 ^^</p>
    </footer>

    <script>
        class SubnetCalculator {
            constructor() {
                this.ipAddress = document.getElementById('ipAddress');
                this.netmaskDecimal = document.getElementById('netmaskDecimal');
                this.netmaskCIDR = document.getElementById('netmaskCIDR');
                this.subnetMethod = document.getElementById('subnetMethod');
                this.subnetValueContainer = document.getElementById('subnetValueContainer');
                this.subnetValue = document.getElementById('subnetValue');
                this.calculateBtn = document.getElementById('calculateBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.resultsSection = document.getElementById('resultsSection');
                this.networkInfo = document.getElementById('networkInfo');
                this.subnetsCard = document.getElementById('subnetsCard');
                this.subnetsInfo = document.getElementById('subnetsInfo');

                this.bindEvents();
                this.syncMaskFromCIDR();
            }

            bindEvents() {
                this.netmaskCIDR.addEventListener('input', () => this.syncMaskFromCIDR());
                this.netmaskDecimal.addEventListener('blur', () => this.syncCIDRFromMask());
                this.subnetMethod.addEventListener('change', () => this.toggleSubnetInput());
                this.calculateBtn.addEventListener('click', () => this.calculate());
                this.clearBtn.addEventListener('click', () => this.clear());
            }

            toggleSubnetInput() {
                const method = this.subnetMethod.value;
                if (method === 'none') {
                    this.subnetValueContainer.style.display = 'none';
                    this.subnetValue.value = '';
                    return;
                }

                this.subnetValueContainer.style.display = 'block';
                const label = this.subnetValueContainer.querySelector('label');
                if (method === 'cidr') {
                    label.textContent = 'Nuevo CIDR (/):';
                    this.subnetValue.placeholder = 'Ej: 26';
                    this.subnetValue.min = '0';
                    this.subnetValue.max = '32';
                } else if (method === 'count') {
                    label.textContent = 'Número de subredes:';
                    this.subnetValue.placeholder = 'Ej: 4';
                    this.subnetValue.min = '2';
                    this.subnetValue.max = '1048576';
                } else {
                    label.textContent = 'Hosts necesarios por subred:';
                    this.subnetValue.placeholder = 'Ej: 50';
                    this.subnetValue.min = '1';
                    this.subnetValue.max = '4294967294';
                }
            }

            calculate() {
                try {
                    const ip = this.ipAddress.value.trim();
                    const cidr = parseInt(this.netmaskCIDR.value, 10);
                    const method = this.subnetMethod.value;
                    const subnetValueRaw = this.subnetValue.value.trim();

                    if (!this.isValidIPv4(ip)) {
                        throw new Error('Dirección IP inválida.');
                    }
                    if (Number.isNaN(cidr) || cidr < 0 || cidr > 32) {
                        throw new Error('CIDR inválido. Debe estar entre 0 y 32.');
                    }

                    const base = this.calculateNetwork(ip, cidr);
                    let targetCIDR = cidr;

                    if (method === 'cidr') {
                        if (!subnetValueRaw) {
                            throw new Error('Introduce el nuevo CIDR.');
                        }
                        targetCIDR = parseInt(subnetValueRaw, 10);
                        if (Number.isNaN(targetCIDR) || targetCIDR < cidr || targetCIDR > 32) {
                            throw new Error(`El nuevo CIDR debe estar entre /${cidr} y /32.`);
                        }
                    }

                    if (method === 'count') {
                        if (!subnetValueRaw) {
                            throw new Error('Introduce el número de subredes.');
                        }
                        const subnetCountRequested = parseInt(subnetValueRaw, 10);
                        if (Number.isNaN(subnetCountRequested) || subnetCountRequested < 2) {
                            throw new Error('El número de subredes debe ser mayor o igual a 2.');
                        }
                        const borrowedBits = Math.ceil(Math.log2(subnetCountRequested));
                        targetCIDR = cidr + borrowedBits;
                        if (targetCIDR > 32) {
                            throw new Error('No es posible crear tantas subredes con la red base indicada.');
                        }
                    }

                    if (method === 'hosts') {
                        if (!subnetValueRaw) {
                            throw new Error('Introduce los hosts necesarios.');
                        }
                        const hostsRequested = parseInt(subnetValueRaw, 10);
                        if (Number.isNaN(hostsRequested) || hostsRequested < 1) {
                            throw new Error('El número de hosts debe ser mayor o igual a 1.');
                        }
                        const hostBits = Math.ceil(Math.log2(hostsRequested + 2));
                        targetCIDR = 32 - hostBits;
                        if (targetCIDR < cidr) {
                            throw new Error('La red base es demasiado pequeña para ese número de hosts por subred.');
                        }
                    }

                    const subnets = this.generateSubnets(base.networkInt, cidr, targetCIDR);
                    this.renderResults(base, targetCIDR, subnets);
                } catch (err) {
                    alert(err.message);
                }
            }

            renderResults(base, targetCIDR, subnets) {
                const hostsPerSubnet = this.getUsableHosts(targetCIDR);
                this.networkInfo.innerHTML = `
                    <div class="alert alert-info">
                        <p><strong>Red base:</strong> ${base.networkAddress}/${base.cidr}</p>
                        <p><strong>Broadcast base:</strong> ${base.broadcastAddress}</p>
                        <p><strong>Máscara decimal:</strong> ${this.cidrToMask(base.cidr)}</p>
                        <p><strong>Nueva máscara:</strong> /${targetCIDR} (${this.cidrToMask(targetCIDR)})</p>
                        <p><strong>Subredes generadas:</strong> ${subnets.length}</p>
                        <p><strong>Hosts utilizables por subred:</strong> ${hostsPerSubnet}</p>
                    </div>
                `;

                const renderLimit = 256;
                const visible = subnets.slice(0, renderLimit);
                const rows = visible.map((s, i) => `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${s.network}/${targetCIDR}</td>
                        <td>${s.firstHost}</td>
                        <td>${s.lastHost}</td>
                        <td>${s.broadcast}</td>
                    </tr>
                `).join('');

                const warning = subnets.length > renderLimit
                    ? `<div class="alert alert-warning mt-3">Mostrando ${renderLimit} de ${subnets.length} subredes para no saturar la página.</div>`
                    : '';

                this.subnetsInfo.innerHTML = `
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Red</th>
                                    <th>Primer host</th>
                                    <th>Último host</th>
                                    <th>Broadcast</th>
                                </tr>
                            </thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </div>
                    ${warning}
                `;

                this.resultsSection.style.display = 'block';
                this.subnetsCard.style.display = 'block';
            }

            clear() {
                this.ipAddress.value = '192.168.1.100';
                this.netmaskCIDR.value = '24';
                this.syncMaskFromCIDR();
                this.subnetMethod.value = 'none';
                this.subnetValue.value = '';
                this.subnetValueContainer.style.display = 'none';
                this.resultsSection.style.display = 'none';
                this.subnetsCard.style.display = 'none';
                this.networkInfo.innerHTML = '';
                this.subnetsInfo.innerHTML = '';
            }

            syncMaskFromCIDR() {
                const cidr = parseInt(this.netmaskCIDR.value, 10);
                if (!Number.isNaN(cidr) && cidr >= 0 && cidr <= 32) {
                    this.netmaskDecimal.value = this.cidrToMask(cidr);
                }
            }

            syncCIDRFromMask() {
                const mask = this.netmaskDecimal.value.trim();
                const cidr = this.maskToCidr(mask);
                if (cidr === null) {
                    alert('Máscara decimal inválida.');
                    return;
                }
                this.netmaskCIDR.value = String(cidr);
            }

            isValidIPv4(ip) {
                const parts = ip.split('.');
                if (parts.length !== 4) return false;
                return parts.every(p => {
                    if (!/^\d+$/.test(p)) return false;
                    const n = Number(p);
                    return n >= 0 && n <= 255;
                });
            }

            ipToInt(ip) {
                const parts = ip.split('.').map(Number);
                return (((parts[0] << 24) >>> 0) + ((parts[1] << 16) >>> 0) + ((parts[2] << 8) >>> 0) + (parts[3] >>> 0)) >>> 0;
            }

            intToIp(intValue) {
                return [
                    (intValue >>> 24) & 255,
                    (intValue >>> 16) & 255,
                    (intValue >>> 8) & 255,
                    intValue & 255
                ].join('.');
            }

            cidrToMask(cidr) {
                const mask = cidr === 0 ? 0 : (0xffffffff << (32 - cidr)) >>> 0;
                return this.intToIp(mask);
            }

            maskToCidr(mask) {
                if (!this.isValidIPv4(mask)) return null;
                const maskInt = this.ipToInt(mask);
                let sawZero = false;
                let cidr = 0;
                for (let i = 31; i >= 0; i--) {
                    const bit = (maskInt >>> i) & 1;
                    if (bit === 1) {
                        if (sawZero) return null;
                        cidr++;
                    } else {
                        sawZero = true;
                    }
                }
                return cidr;
            }

            calculateNetwork(ip, cidr) {
                const ipInt = this.ipToInt(ip);
                const maskInt = cidr === 0 ? 0 : (0xffffffff << (32 - cidr)) >>> 0;
                const networkInt = (ipInt & maskInt) >>> 0;
                const blockSize = 2 ** (32 - cidr);
                const broadcastInt = (networkInt + blockSize - 1) >>> 0;
                return {
                    cidr,
                    networkInt,
                    broadcastInt,
                    networkAddress: this.intToIp(networkInt),
                    broadcastAddress: this.intToIp(broadcastInt)
                };
            }

            getUsableHosts(cidr) {
                const hostBits = 32 - cidr;
                if (hostBits === 0) return 1;
                if (hostBits === 1) return 2;
                return (2 ** hostBits) - 2;
            }

            generateSubnets(baseNetworkInt, baseCIDR, targetCIDR) {
                const subnetBlockSize = 2 ** (32 - targetCIDR);
                const subnetCount = 2 ** (targetCIDR - baseCIDR);
                const result = [];

                for (let i = 0; i < subnetCount; i++) {
                    const networkInt = (baseNetworkInt + (i * subnetBlockSize)) >>> 0;
                    const broadcastInt = (networkInt + subnetBlockSize - 1) >>> 0;
                    const firstHostInt = targetCIDR >= 31 ? networkInt : (networkInt + 1) >>> 0;
                    const lastHostInt = targetCIDR >= 31 ? broadcastInt : (broadcastInt - 1) >>> 0;

                    result.push({
                        network: this.intToIp(networkInt),
                        firstHost: this.intToIp(firstHostInt),
                        lastHost: this.intToIp(lastHostInt),
                        broadcast: this.intToIp(broadcastInt)
                    });
                }
                return result;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new SubnetCalculator();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    </script>
    <script src="assets/js/site-sfx.js"></script>
    <script src="assets/js/site-theme.js"></script>
</body>
</html>












