<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - Source-IT</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts - Fuentes futuristas -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/site.css">
    <style>
        .home-search-panel {
            border: 1px solid #d7e4f2;
            border-radius: 14px;
            background: linear-gradient(165deg, #ffffff 0%, #eef5ff 100%);
            box-shadow: 0 10px 20px rgba(8, 22, 40, 0.08);
            padding: 0.95rem;
        }
        .home-search-title {
            display: block;
            margin-bottom: 0.45rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: #17385c;
        }
        .home-search-input {
            border: 1px solid #b7d0eb;
            font-family: 'JetBrains Mono', monospace;
            color: #122b4b;
        }
        .home-search-input:focus {
            border-color: #0b66d1;
            box-shadow: 0 0 0 0.2rem rgba(11, 102, 209, 0.16);
        }
        .home-search-meta {
            margin-top: 0.55rem;
            margin-bottom: 0;
            color: #355372;
            font-size: 0.82rem;
        }
        .home-search-results {
            margin-top: 0.7rem;
            max-height: 280px;
            overflow: auto;
            border: 1px solid #cfdeef;
            border-radius: 10px;
            background: #ffffff;
        }
        .home-search-item {
            display: block;
            text-decoration: none;
            border-bottom: 1px solid #e4ecf6;
            padding: 0.65rem 0.75rem;
            color: #15385f;
            transition: background-color 0.2s ease;
        }
        .home-search-item:last-child {
            border-bottom: 0;
        }
        .home-search-item:hover {
            background: #f0f6ff;
        }
        .home-search-item:focus-visible {
            outline: 2px solid #0b66d1;
            outline-offset: -2px;
        }
        .home-search-item strong {
            display: block;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.03em;
            text-transform: none;
            margin-bottom: 0.2rem;
            color: #102c49;
        }
        .home-search-where {
            display: block;
            font-size: 0.8rem;
            color: #335a80;
            margin-bottom: 0.2rem;
            font-family: 'JetBrains Mono', monospace;
        }
        .home-search-desc {
            display: block;
            font-size: 0.84rem;
            color: #2b4663;
        }
        #homeGrid .card.home-search-hit {
            border-top: 3px solid #0b66d1;
            box-shadow: 0 16px 30px rgba(11, 102, 209, 0.2);
        }
        #homeGrid .card.home-search-dim {
            opacity: 0.38;
            filter: saturate(0.65);
        }
    </style>
</head>
<body>
    <!-- Animacion Mr. Robot (frase aleatoria + baile 4s) -->
    <div id="mr-robot-glitch">🤖 Hello, friend</div>

    <!-- Navbar Neón -->
    <nav class="navbar-neon navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="neon-text" href="index.html">
                <span class="brand-icon"><i class="bi bi-house-door"></i></span>
                <span class="brand-label">SOURCE-IT</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Abrir navegacion" style="border-color: #00ff88;">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link-neon" href="guia_redes.html">Redes</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="replanteos_red.html">Replanteos</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="linux_cheatsheet.html">Linux</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="virtualbox.html">VirtualBox</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="conversor_binario_hexadecimal.html">Conversor</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="MySQL.html">MySQL</a></li>
                    <li class="nav-item"><a class="nav-link-neon" href="dhcp_dns.html">DHCP/DNS</a></li>
                    <!-- dropdown overflow -->
                    <li class="nav-item dropdown">
                        <a class="nav-link-neon dropdown-toggle" href="#" id="moreMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">Más</a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="moreMenu">
                            <li><a class="dropdown-item" href="lenguajes_de_marcas.html">Lenguajes</a></li>
                            <li><a class="dropdown-item" href="Css_basico.html">CSS Básico</a></li>
                            <li><a class="dropdown-item" href="Js_basico.html">JavaScript</a></li>
                            <li><a class="dropdown-item" href="python.html">Python</a></li>
                            <li><a class="dropdown-item" href="figma.html">Figma</a></li>
                            <li><a class="dropdown-item" href="hacking_etico.html">Hacking Ético</a></li>
                            <li><a class="dropdown-item" href="ia_lanzadera.html">IA</a></li>
                            <li><a class="dropdown-item" href="freeplane.html">Freeplane</a></li>
                            <li><a class="dropdown-item" href="visualstudio_code.html">Visual Studio Code</a></li>
                            <li><a class="dropdown-item" href="git_github.html">Git/GitHub</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid app-shell py-4">
        <div id="homeHero" class="hero text-center mb-5">
            <h1 class="hero-sourceit">
                <span class="brand-icon"><i class="bi bi-house-door"></i></span>
                <span class="brand-label">SOURCE-IT</span>
                <span class="hero-tagline">My Path by Jemarin</span>
            </h1>
            <p class="mb-0">Guía de recursos educativos(mis apuntes) en una sola ventana. Contactame si crees que algo es erroneo o debe mejorarse, Eskerrik asko!.</p>
        </div>
        <section class="sections-board">
        <div id="homeGrid" class="row g-4">
            <!-- panel de búsqueda integrado -->
            <div class="col-12">
                <div id="homeSearchPanel" class="home-search-panel">
                    <label for="homeSearchInput" class="home-search-title">Buscar en el sitio</label>
                    <input type="search" id="homeSearchInput" class="form-control home-search-input" placeholder="Escribe para buscar..." aria-label="Buscar en la página de inicio">
                    <p id="homeSearchMeta" class="home-search-meta">0 resultados</p>
                    <div id="homeSearchResults" class="home-search-results" aria-label="Resultados de búsqueda"></div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-diagram-3 fs-1"></i>
                    <h3 class="mt-3">Redes</h3>
                    <p>Subnetting, VLSM, DHCP, DNS y calculadora IP.</p>
                    <a href="guia_redes.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <!-- tarjeta independiente para calculadora IP -->
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-calculator fs-1"></i>
                    <h3 class="mt-3">Calculadora IP</h3>
                    <p>Calcula subredes, rangos y hosts de manera interactiva.</p>
                    <a href="guia_redes.html#calculadora" class="btn btn-outline-primary mt-3">Usar</a>
                </div>
            </div>
            <!-- tarjeta VS Code -->
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-code-slash fs-1"></i>
                    <h3 class="mt-3">Visual Studio Code</h3>
                    <p>Editor gratuito con extensiones, themes y asistentes AI (Visual Studio Code).</p>
                    <a href="visualstudio_code.html" class="btn btn-outline-primary mt-3">Abrir</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-diagram-2 fs-1"></i>
                    <h3 class="mt-3">Replanteos</h3>
                    <p>Casos de replanteo de red en infraestructuras grandes, anonimizados para portfolio.</p>
                    <a href="replanteos_red.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-terminal fs-1"></i>
                    <h3 class="mt-3">Linux</h3>
                    <p>Comandos esenciales, shell, permisos, y cheatsheets.</p>
                    <a href="linux_cheatsheet.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-hdd-stack fs-1"></i>
                    <h3 class="mt-3">VirtualBox</h3>
                    <p>Crea máquinas virtuales con Debian 13 y configura redes.</p>
                    <a href="virtualbox.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-arrow-left-right fs-1"></i>
                    <h3 class="mt-3">Conversor</h3>
                    <p>Binario a hexadecimal con explicación paso a paso.</p>
                    <a href="conversor_binario_hexadecimal.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-database-gear fs-1"></i>
                    <h3 class="mt-3">MySQL</h3>
                    <p>Gestión de usuarios, permisos y vistas en MySQL.</p>
                    <a href="MySQL.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-router fs-1"></i>
                    <h3 class="mt-3">DHCP/DNS</h3>
                    <p>Servidores DHCP y DNS en VirtualBox con múltiples SO.</p>
                    <a href="dhcp_dns.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-code-square fs-1"></i>
                    <h3 class="mt-3">Lenguajes</h3>
                    <p>XML, HTML, XSD, XPath, XQuery y más.</p>
                    <a href="lenguajes_de_marcas.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-filetype-css fs-1"></i>
                    <h3 class="mt-3">CSS Básico</h3>
                    <p>Cascada, especificidad, Grid/Flex y arquitectura de estilos.</p>
                    <a href="Css_basico.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-filetype-js fs-1"></i>
                    <h3 class="mt-3">JavaScript</h3>
                    <p>Event loop, asincronía, modularidad y laboratorio práctico.</p>
                    <a href="Js_basico.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-filetype-py fs-1"></i>
                    <h3 class="mt-3">Python</h3>
                    <p>Anaconda, Jupyter Desktop, scripts y Flask para construir APIs.</p>
                    <a href="python.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-palette2 fs-1"></i>
                    <h3 class="mt-3">Figma</h3>
                    <p>Diseño UI, prototipado, auto layout y trabajo colaborativo con hand-off para desarrollo.</p>
                    <a href="figma.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-shield-lock fs-1"></i>
                    <h3 class="mt-3">Hacking Ético</h3>
                    <p>Conceptos, Wi-Fi, herramientas y comandos para auditoría autorizada.</p>
                    <a href="hacking_etico.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-stars fs-1"></i>
                    <h3 class="mt-3">IA Lanzadera</h3>
                    <p>Chatbots, vídeo IA, OpenClaw y plataformas creativas en un solo panel.</p>
                    <a href="ia_lanzadera.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-diagram-3 fs-1"></i>
                    <h3 class="mt-3">Freeplane</h3>
                    <p>Mapas mentales, atajos y ejemplos para gestionar ideas gráficamente.</p>
                    <a href="freeplane.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 p-4 text-center">
                    <i class="bi bi-git fs-1"></i>
                    <h3 class="mt-3">Git/GitHub</h3>
                    <p>Instalación, comandos, repos útiles y flujo de trabajo para colaborar.</p>
                    <a href="git_github.html" class="btn btn-outline-primary mt-3">Acceder</a>
                </div>
            </div>
        </div>
        <main id="spaContent" class="d-none mt-4"></main>
        </section>
        <div class="alert alert-success-custom alert-custom mt-4 text-center">
            <strong>Contáctame:</strong> <a href="mailto:jemarin@birt.eus">jemarin@birt.eus</a> |
            <strong>Discord:</strong> <a href="https://discord.gg/byCRavuB7e" target="_blank" rel="noopener noreferrer">discord.gg/byCRavuB7e</a>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5">
        <p class="mb-1 d-inline-flex align-items-center gap-2">
            <span>Created by Jemarin, si me tocas el pingüino cambio de color ^^</span>
            <button id="themeToggle" class="theme-btn btn ms-1" title="Cambiar tema">
                <span class="penguin" aria-hidden="true">&#128039;</span>
                <span class="visually-hidden">Cambiar tema</span>
            </button>
        </p>
        <small class="support-note">
            <button type="button" class="support-note-trigger" aria-describedby="supportNoteTooltip">¿Necesitas soporte técnico? Mi hucha y tu red te lo agradecen.</button>
            <span id="supportNoteTooltip" class="support-note-tooltip" role="tooltip">Si tienes problemas con la red o con tus equipos en casa o en empresa, puedo realizar un estudio de cobertura y un plano técnico con LIDAR o AutoCAD para que ningún punto se quede sin señal ni con bajo rendimiento. También puedo modificar tu equipo: ampliaciones, modificaciones, cajas a medida, mejora de refrigeración, overclock, underclock y delid cuando procede. Además, instalo repetidores, switches y VPN propia; puedo crearte una web funcional o enseñarte cualquiera de las tecnologías que ves en esta web. Cuando una instalación está bien diseñada y ejecutada, el soporte a distancia es más eficiente. ¿Hablamos?</span>
        </small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        const robot = document.getElementById('mr-robot-glitch');
        const robotPhrases = [
            'Compilo tus excusas en modo produccion.',
            'Tu bug no esta roto, esta en modo artistico.',
            'He revisado el log y tu cafe no esta actualizado.',
            'Si funciona en tu maquina, no era magia, era miedo.',
            'No toques eso, lo hice con 3 tutoriales y fe.',
            'Acabo de parchear el caos con cinta aislante digital.',
            'Deploy de viernes detectado, procedo a rezar.',
            'Tu codigo tiene personalidad, y tambien traumas.',
            'Tengo 99 problemas, y 120 pestañas abiertas.',
            'Reiniciar no arregla todo, pero anima bastante.',
            'El codigo compila, pero mi autoestima sigue en beta.',
            'Hoy debuguee tanto que ya pienso en stack traces.',
            'Mi teclado pidio vacaciones despues de este merge.',
            'Tu variable se llama x, pero el misterio es XXL.',
            'La documentacion existe, solo vive en otra dimension.',
            'Si rompe en produccion, le llamamos feature sorpresa.',
            'He hecho 1 commit y 47 respiraciones profundas.',
            'Tu CSS no esta mal, solo practica parkour.',
            'Acabo de vencer un bug, ahora somos amigos toxicos.',
            'Mi plan era dormir; npm dijo que no.',
            'Ese warning no grita, susurra amenazas.',
            'He usado IA para todo menos para lavar platos.',
            'Tu regex funciona, pero nadie sabe por que.',
            'Refactorice tanto que ahora no reconozco mi propio codigo.',
            'El servidor responde, yo no prometo lo mismo.',
            'Tu pull request viene con plot twist en cada linea.',
            'Esto no es deuda tecnica, es hipoteca.',
            'Si no hay logs, no hay crimen.',
            'Mi algoritmo corre rapido cuando no lo miro.',
            'Acabo de comentar una linea y subio el FPS.'
        ];
        const robotTrajectories = [
            { startX: '-120vw', startY: '8vh', midX: '31vw', midY: '20vh', endX: '108vw', endY: '12vh' },
            { startX: '110vw', startY: '12vh', midX: '40vw', midY: '26vh', endX: '-118vw', endY: '16vh' },
            { startX: '-95vw', startY: '92vh', midX: '28vw', midY: '52vh', endX: '108vw', endY: '-24vh' },
            { startX: '108vw', startY: '88vh', midX: '52vw', midY: '54vh', endX: '-112vw', endY: '-26vh' },
            { startX: '42vw', startY: '-40vh', midX: '43vw', midY: '22vh', endX: '114vw', endY: '84vh' },
            { startX: '45vw', startY: '112vh', midX: '44vw', midY: '46vh', endX: '-108vw', endY: '2vh' },
            { startX: '-118vw', startY: '45vh', midX: '34vw', midY: '40vh', endX: '112vw', endY: '66vh' },
            { startX: '115vw', startY: '35vh', midX: '49vw', midY: '32vh', endX: '-118vw', endY: '78vh' }
        ];
        let lastRobotPhraseIndex = -1;

        function pickRandomIndex(length, previous) {
            if (length <= 1) return 0;
            let idx = Math.floor(Math.random() * length);
            while (idx === previous) {
                idx = Math.floor(Math.random() * length);
            }
            return idx;
        }

        function playRobotGlitchIntro() {
            if (!robot) return;
            const phraseIndex = pickRandomIndex(robotPhrases.length, lastRobotPhraseIndex);
            lastRobotPhraseIndex = phraseIndex;
            const trajectory = robotTrajectories[Math.floor(Math.random() * robotTrajectories.length)];

            robot.textContent = `🤖 ${robotPhrases[phraseIndex]}`;
            robot.style.setProperty('--rg-start-x', trajectory.startX);
            robot.style.setProperty('--rg-start-y', trajectory.startY);
            robot.style.setProperty('--rg-mid-x', trajectory.midX);
            robot.style.setProperty('--rg-mid-y', trajectory.midY);
            robot.style.setProperty('--rg-end-x', trajectory.endX);
            robot.style.setProperty('--rg-end-y', trajectory.endY);

            robot.classList.remove('robot-glitch-run');
            robot.style.display = 'block';
            void robot.offsetWidth;
            robot.classList.add('robot-glitch-run');
        }

        if (robot) {
            robot.addEventListener('animationend', (event) => {
                if (event.animationName !== 'robot-glitch-intro') return;
                robot.classList.remove('robot-glitch-run');
                robot.style.display = 'none';
            });
        }

        const homeHero = document.getElementById('homeHero');
        const homeGrid = document.getElementById('homeGrid');
        const spaContent = document.getElementById('spaContent');
        const useIframeSpa = location.protocol === 'file:';
        const spaRoutes = new Set([
            'guia_redes.html',
            'replanteos_red.html',
            'linux_cheatsheet.html',
            'virtualbox.html',
            'conversor_binario_hexadecimal.html',
            'MySQL.html',
            'dhcp_dns.html',
            'lenguajes_de_marcas.html',
            'Css_basico.html',
            'Js_basico.html',
            'python.html',
            'figma.html',
            'hacking_etico.html',
            'ia_lanzadera.html',
            'git_github.html',
            'freeplane.html',
            'visualstudio_code.html'
        ]);
        let injectedStyleNodes = [];
        let injectedScriptNodes = [];
        let spaFrame = null;
        let activeSpaRoute = 'home';

        // ---- búsqueda en inicio ------------------------------------------------
        const searchInput = document.getElementById('homeSearchInput');
        const searchMeta = document.getElementById('homeSearchMeta');
        const searchResults = document.getElementById('homeSearchResults');
        let searchItems = [];

        function buildSearchIndex() {
            searchItems = [];
            const cards = document.querySelectorAll('#homeGrid .card');
            cards.forEach((card) => {
                const title = card.querySelector('h3')?.textContent.trim() || '';
                const desc = card.querySelector('p')?.textContent.trim() || '';
                const anchor = card.querySelector('a');
                const href = anchor ? anchor.getAttribute('href') : '';
                searchItems.push({ title, desc, href, card });
            });
        }

        function renderSearchResults(query) {
            if (!searchResults || !searchMeta) return;
            searchResults.innerHTML = '';
            const clean = query.trim().toLowerCase();
            if (!clean) {
                searchMeta.textContent = '0 resultados';
                searchItems.forEach((item) => {
                    item.card.classList.remove('home-search-hit', 'home-search-dim');
                });
                return;
            }
            let count = 0;
            searchItems.forEach((item) => {
                const haystack = (item.title + ' ' + item.desc).toLowerCase();
                const match = haystack.includes(clean);
                if (match) {
                    count++;
                    const a = document.createElement('a');
                    a.href = '#';
                    a.className = 'home-search-item';
                    a.innerHTML = `<strong>${item.title}</strong>` +
                        `<span class="home-search-where">dónde está: ${item.href}</span>` +
                        `<span class="home-search-desc">${item.desc}</span>`;
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        loadRoute(normalizeRoute(item.href), true);
                    });
                    searchResults.appendChild(a);
                    item.card.classList.add('home-search-hit');
                    item.card.classList.remove('home-search-dim');
                } else {
                    item.card.classList.remove('home-search-hit');
                    item.card.classList.add('home-search-dim');
                }
            });
            searchMeta.textContent = `${count} resultado${count !== 1 ? 's' : ''}`;
        }

        searchInput?.addEventListener('input', (e) => {
            renderSearchResults(e.target.value || '');
        });

        function resetSearchPanel() {
            if (searchInput) searchInput.value = '';
            renderSearchResults('');
        }
        // ------------------------------------------------------------------------


        function normalizeRoute(route) {
            if (!route) return 'home';
            // strip leading '#' and any fragment portion
            let clean = route.replace(/^#/, '').trim();
            const parts = clean.split('#');
            clean = parts[0];
            if (!clean || clean === 'home' || clean === 'index.html') return 'home';
            return clean.split('/').pop();
        }

        function showHomeView() {
            activeSpaRoute = 'home';
            homeHero.classList.remove('d-none');
            homeGrid.classList.remove('d-none');
            spaContent.classList.add('d-none');
            spaContent.innerHTML = '';
            document.title = 'Inicio - Source-IT';
            window.scrollTo({ top: 0, behavior: 'auto' });
            // preparar buscador
            buildSearchIndex();
            resetSearchPanel();
            playRobotGlitchIntro();
        }

        function clearSpaAssets() {
            injectedStyleNodes.forEach((node) => node.remove());
            injectedScriptNodes.forEach((node) => node.remove());
            injectedStyleNodes = [];
            injectedScriptNodes = [];
        }

        function ensureSpaFrame() {
            if (spaFrame) return spaFrame;
            spaFrame = document.createElement('iframe');
            spaFrame.id = 'spaFrame';
            spaFrame.setAttribute('title', 'Contenido de seccion');
            spaFrame.style.width = '100%';
            spaFrame.style.minHeight = '78vh';
            spaFrame.style.border = '1px solid #dbe4ee';
            spaFrame.style.borderRadius = '14px';
            spaFrame.style.background = '#ffffff';
            return spaFrame;
        }

        function loadRouteInIframe(normalized, pushState = true) {
            activeSpaRoute = normalized;
            clearSpaAssets();
            homeHero.classList.add('d-none');
            homeGrid.classList.add('d-none');
            spaContent.classList.remove('d-none');
            spaContent.innerHTML = '';
            const frame = ensureSpaFrame();
            frame.src = normalized;
            spaContent.appendChild(frame);
            document.title = `Source-IT · ${normalized}`;
            if (pushState) history.pushState({ route: normalized }, '', `index.html#${normalized}`);
            window.scrollTo({ top: 0, behavior: 'auto' });
            playRobotGlitchIntro();
        }

        function injectPageStyles(doc, route) {
            const styleTags = Array.from(doc.querySelectorAll('head style'));
            styleTags.forEach((styleTag, idx) => {
                const styleNode = document.createElement('style');
                styleNode.dataset.spaStyle = `${route}-${idx}`;
                styleNode.textContent = styleTag.textContent || '';
                document.head.appendChild(styleNode);
                injectedStyleNodes.push(styleNode);
            });
        }

        function runPageScripts(doc, route) {
            const scripts = Array.from(doc.querySelectorAll('body script'));
            scripts.forEach((script, idx) => {
                const src = script.getAttribute('src');
                if (src && (src.includes('bootstrap') || src.includes('site-theme.js') || src.includes('site-sfx.js'))) return;
                const node = document.createElement('script');
                node.dataset.spaScript = `${route}-${idx}`;
                if (src) {
                    node.src = src;
                } else {
                    node.textContent = script.textContent || '';
                }
                document.body.appendChild(node);
                injectedScriptNodes.push(node);
            });
        }

        async function loadRoute(route, pushState = true) {
            // handle optional fragment (#anchor)
            let anchor = null;
            let raw = route;
            if (typeof raw === 'string' && raw.includes('#')) {
                const parts = raw.split('#');
                raw = parts[0];
                anchor = parts.slice(1).join('#');
            }
            const normalized = normalizeRoute(raw);
            if (normalized === 'home' || !spaRoutes.has(normalized)) {
                showHomeView();
                if (pushState && location.hash) history.pushState({ route: 'home' }, '', 'index.html');
                return;
            }

            // hide home immediately to avoid flash during network delay
            homeHero.classList.add('d-none');
            homeGrid.classList.add('d-none');
            spaContent.classList.remove('d-none');

            if (useIframeSpa) {
                if (anchor) {
                    loadRouteInIframe(`${normalized}#${anchor}`, pushState);
                } else {
                    loadRouteInIframe(normalized, pushState);
                }
                return;
            }

            try {
                activeSpaRoute = normalized;
                const response = await fetch(normalized, { cache: 'no-cache' });
                if (!response.ok) throw new Error(`No se pudo cargar ${normalized}`);
                const html = await response.text();
                const parsed = new DOMParser().parseFromString(html, 'text/html');

                clearSpaAssets();
                injectPageStyles(parsed, normalized);

                const fragment = document.createDocumentFragment();
                Array.from(parsed.body.children).forEach((child) => {
                    const tag = child.tagName;
                    if (tag === 'NAV' || tag === 'FOOTER' || tag === 'SCRIPT') return;
                    if (child.classList && child.classList.contains('navbar-neon')) return;
                    if (child.id === 'mr-robot-glitch') return;
                    fragment.appendChild(child.cloneNode(true));
                });

                homeHero.classList.add('d-none');
                homeGrid.classList.add('d-none');
                spaContent.classList.remove('d-none');
                spaContent.innerHTML = '';
                spaContent.appendChild(fragment);
                document.title = parsed.title || `Source-IT · ${normalized}`;

                runPageScripts(parsed, normalized);

                if (pushState) {
                    history.pushState({ route: normalized }, '', `index.html#${normalized}` + (anchor ? `#${anchor}` : ''));
                }
                window.scrollTo({ top: 0, behavior: 'auto' });
                if (anchor) {
                    const el = spaContent.querySelector(`#${anchor}`);
                    if (el) {
                        setTimeout(() => el.scrollIntoView({ behavior: 'smooth' }), 50);
                    }
                }
                playRobotGlitchIntro();
            } catch (err) {
                console.error(err);
                loadRouteInIframe(normalized, pushState);
            }
        }

        document.addEventListener('click', (event) => {
            if (event.defaultPrevented) return;
            if (event.button !== 0) return;
            if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;
            const anchor = event.target.closest('a[href]');
            if (!anchor) return;
            const target = (anchor.getAttribute('target') || '').toLowerCase();
            if (target && target !== '_self') return;
            if (anchor.hasAttribute('download')) return;
            const href = anchor.getAttribute('href') || '';
            if (!href || href.startsWith('http') || href.startsWith('mailto:') || href.startsWith('tel:') || href.startsWith('javascript:')) return;
            if (href === '#') return;
            const routeBase = normalizeRoute(href);
            if (routeBase === 'home') {
                event.preventDefault();
                loadRoute('home', true);
                return;
            }
            if (spaRoutes.has(routeBase)) {
                event.preventDefault();
                loadRoute(href, true); // pass full href so fragment can be handled
            }
        });

        window.addEventListener('popstate', () => {
            loadRoute(normalizeRoute(location.hash), false);
        });

        // índice de búsqueda disponible desde el principio
        buildSearchIndex();
        // si al cargar ya venimos con una ruta diferente a home, ocultar el home antes de la petición
        const initialRoute = normalizeRoute(location.hash);
        if (initialRoute !== 'home' && spaRoutes.has(initialRoute)) {
            homeHero.classList.add('d-none');
            homeGrid.classList.add('d-none');
            spaContent.classList.remove('d-none');
        }
        loadRoute(location.hash, false);
    </script>
    <script src="assets/js/site-theme.js"></script>
</body>
</html>
